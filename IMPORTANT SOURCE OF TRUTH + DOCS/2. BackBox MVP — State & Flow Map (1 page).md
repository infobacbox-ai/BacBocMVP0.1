# **BackBox MVP — State & Flow Map (1 page)**

Version: v0.3 — 23 jan 2026 (MVP simplifié)

## **1\) États (canon)**

### **1.1 Entitlement (produit)**

* **none** → pas d’accès app → **/access**  
* **trial\_one\_run** → **1 seul projet total** (one-run)  
* **paid** → multi-projets

### **1.2 AccessState (implémentation)**

* **NONE** : entitlement=none  
* **PAID** : entitlement=paid  
* **TRIAL\_AVAILABLE** : entitlement=trial\_one\_run \+ `trialProjectId = null`  
* **TRIAL\_ACTIVE** : entitlement=trial\_one\_run \+ `trialProjectId != null`

MVP : pas d’UI de suppression de projet. (Les invariants “delete/reset/orphan” sont reportés.)

### **1.3 Projet (BackBox)**

* `currentStep` : **p1 | p2 | p3 | p4 | final** (sert au bouton “Reprendre”)  
* `mode` : **trial | paid**

### **1.4 IA (par pilier P1–P4)**

* **IDLE** → **EVALUATING** → **RECAP\_READY**  
* Échec IA : **1 retry max** côté UI → sinon **AI\_UNAVAILABLE**  
* **Un seul limiteur (MVP)** : **rate-limit global** (ex: 10 évaluations / heure / user)  
* **Concurrence simplifiée (MVP)** : bouton “Évaluer” désactivé pendant l’appel ; serveur “best effort” renvoie “déjà en cours” si besoin.

## **2\) App map (routes)**

* **/access** : auth \+ “Commencer l’essai” \+ “Passer Premium”  
* **/backbox** : dashboard  
* **/backbox/start** : coller texte \+ démarrer  
* Wizard :  
  * **/backbox/\[id\]/p1** \+ **/p1/recap**  
  * **/backbox/\[id\]/p2** \+ **/p2/recap**  
  * **/backbox/\[id\]/p3** \+ **/p3/recap**  
  * **/backbox/\[id\]/p4** \+ **/p4/recap**  
* **/backbox/\[id\]/final** : page “Résultats” (récap final \+ copier)

## **3\) Flow principal (happy path)**

### **3.1 Entrée**

1. **NONE** → /access → login/signup  
2. Auth OK → /backbox

### **3.2 Dashboard /backbox**

* **TRIAL\_AVAILABLE** : CTA **“Nouveau texte (essai)”** → /backbox/start  
* **TRIAL\_ACTIVE** : CTA **“Continuer mon parcours”** → `/backbox/{trialId}/{currentStep}`  
  * “Nouveau texte” désactivé \+ tooltip “1 seul projet en essai” \+ CTA **“Passer Premium”**  
* **PAID** : CTA **“Nouveau texte”** → /backbox/start \+ liste projets

### **3.3 /backbox/start (consommation du trial)**

* Submit `sourceText` :  
  * si **TRIAL\_AVAILABLE** → `startTrialProject()` : crée le projet trial \+ fixe `trialProjectId`  
  * si **PAID** → `createPaidProject()`  
* Redirect → `/backbox/{projectId}/p1`

### **3.4 Wizard P1→P4**

Pour chaque pilier Px :

* `/px` : formulaire \+ autosave (sauvegarde du **dernier brouillon**)  
* “Évaluer cette étape” → mini‑récap  
* succès → `/px/recap` :  
  * “Améliorer” (optionnel)  
  * “Continuer” → `/p(next)`

Règle Stepper (produit) :

* clic autorisé uniquement sur steps **≤ currentStep**  
* impossible de sauter une étape non commencée  
* retour autorisé sur étapes déjà passées

### **3.5 Résultats (final)**

* `/final` : bouton **“Générer récap final”** → `generateFinalRecap()`  
* Affichage : récap final (format simple, cf. §6)  
* CTA : **“Copier”** (clipboard) \+ option “Imprimer” via navigateur (pas d’export HTML dédié)  
* Fin :  
  * **PAID** : “Recommencer avec un autre texte” → /backbox/start  
  * **TRIAL** : CTA **“Passer Premium”**

## **4\) Points de gating (MVP)**

* `startTrialProject` : **TRIAL\_AVAILABLE only** (sinon refus)  
* `createPaidProject` : **PAID only**  
* Si user **non paid** : write/IA autorisés uniquement si `projectId === trialProjectId`  
* **Un seul limiteur** : rate-limit global évaluations (mini \+ final)

## **5\) Erreurs UI (univers réduit à 3 états)**

### **5.1 Les 3 états UX**

1. **Problème d’accès** : “Reconnecte-toi / Accès refusé”  
2. **Réessayer plus tard** : “Trop de demandes / Attends puis réessaie”  
3. **Quelque chose s’est mal passé** : “Erreur inattendue”

### **5.2 Mapping (interne → UI)**

* **401/403** → (1) Problème d’accès  
* **429** → (2) Réessayer plus tard  
* **400/404/409/500 \+ tout le reste** → (3) Quelque chose s’est mal passé

MVP : on conserve les codes internes pour debug, mais l’UI ne shippe que ces 3 écrans.

### **5.3 Panne IA (no fallback)**

* 1 échec IA → UI propose **1 retry max** (“Réessayer”)  
* échec au retry → écran “IA indisponible” :  
  * CTA “Réessayer plus tard” \+ “Retour au pilier”  
  * aucune mini‑récap n’est enregistrée

## **6\) Structure des récaps (MVP simplifié)**

* Mini‑récap (P1..P4) :  
  * **2 forces**  
  * **2 améliorations**  
  * **1 prochaine action**  
* Récap final : même structure (plus synthétique), présenté sur la page “Résultats”.

## **7\) Notes de mapping Figma**

* Sidebar Questions‑guides \+ TEXTE : visible **uniquement sur /p1..p4**.  
* Sur `/px/recap` et `/final` : sidebar masquée (écran plus léger).  
* Pas de chat : l’assistance \= questions‑guides \+ lien “Voir le cours du pilier”.

